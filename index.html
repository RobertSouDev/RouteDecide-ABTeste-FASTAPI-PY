<!DOCTYPE html>
<html>
<head>
    <title>Teste A/B - Frontend</title>
    
        <script 
          src="frontend-sdk/ab-test-sdk.js"
          data-test-id="landing_001"
          data-api-url="http://localhost:8000">
        </script>
    
</head>
<body>
    <div id="app">
        <h1>Carregando...</h1>
    </div>

    <script>
        // Função para aguardar o SDK inicializar
        function waitForSDK(callback, maxAttempts = 50) {
            let attempts = 0;
            
            const checkSDK = setInterval(function() {
                attempts++;
                
                if (window.testeab && window.testeab.isInitialized) {
                    clearInterval(checkSDK);
                    callback();
                } else if (attempts >= maxAttempts) {
                    clearInterval(checkSDK);
                    console.error('SDK não inicializou após', maxAttempts * 100, 'ms');
                    document.getElementById('app').innerHTML = 
                        '<p style="color: red;">Erro: SDK não inicializou</p>';
                }
            }, 100);
        }

        // Função para carregar e exibir as seções
        async function loadSections() {
            const app = document.getElementById('app');
            const sections = window.testeab.sections;
            const variantId = window.testeab.variantId;

            if (!sections || sections.length === 0) {
                app.innerHTML = '<p>Nenhuma seção encontrada</p>';
                return;
            }

            // Exibir informações da variante
            let html = `
                <div style="margin-bottom: 20px; padding: 15px; background: #f0f0f0; border-radius: 5px;">
                    <h2>Informações do Teste A/B</h2>
                    <p><strong>Variante ID:</strong> ${variantId || 'N/A'}</p>
                    <p><strong>Total de Seções:</strong> ${sections.length}</p>
                </div>
            `;

            // Carregar cada seção
            for (const section of sections) {
                html += `
                    <div style="margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px;">
                        <h3>Seção: ${section.id}</h3>
                        <p><strong>URL:</strong> <a href="${section.contentUrl}" target="_blank">${section.contentUrl}</a></p>
                        <div id="section-${section.id}" style="margin-top: 10px; padding: 10px; background: #f9f9f9; border-radius: 3px;">
                            <p>Carregando conteúdo...</p>
                        </div>
                        <button style="margin-top: 15px; padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px;">
                            Clique Aqui - ${section.id}
                        </button>
                    </div>
                `;
            }

            app.innerHTML = html;

            // Carregar conteúdo de cada seção
            for (const section of sections) {
                try {
                    const response = await fetch(section.contentUrl);
                    if (response.ok) {
                        const content = await response.text();
                        const sectionDiv = document.getElementById(`section-${section.id}`);
                        if (sectionDiv) {
                            sectionDiv.innerHTML = content;
                        }
                    } else {
                        const sectionDiv = document.getElementById(`section-${section.id}`);
                        if (sectionDiv) {
                            sectionDiv.innerHTML = `<p style="color: orange;">Erro ao carregar: ${response.status} ${response.statusText}</p>`;
                        }
                    }
                } catch (error) {
                    console.error(`Erro ao carregar seção ${section.id}:`, error);
                    const sectionDiv = document.getElementById(`section-${section.id}`);
                    if (sectionDiv) {
                        sectionDiv.innerHTML = `<p style="color: red;">Erro ao carregar conteúdo: ${error.message}</p>`;
                    }
                }
            }
        }

        // Aguardar SDK e então carregar seções
        waitForSDK(loadSections);
    </script>
    
</body>
</html>